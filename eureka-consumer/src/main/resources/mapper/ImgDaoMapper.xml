<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.eurekaconsumer.dao.ImgMainDao">

	<select id="queryImgInfo" resultType="com.example.eurekaconsumer.entity.ImgMainEntity">
		SELECT id, url, name, local FROM img_main
	</select>


	<select id="queryDistById" resultType="com.example.eurekaconsumer.entity.ImgMainEntity" parameterType="java.util.List">
		SELECT im.id, im.url, im.name, im.local, FORMAT(id.distances,2) distances
		  FROM img_main im,(
		select img_id_b, AVG(distances) distances
		  from img_dist
		 where img_id_a in
		<foreach collection="list" index="index" item="item" open="("
				 separator="," close=")">
			#{item}
		</foreach>
	  group by img_id_b
		  ) id
		 WHERE id.img_id_b = im.id
	  ORDER BY id.distances
	     LIMIT 10
	</select>

	<select id="queryDistByIdTwo" resultType="com.example.eurekaconsumer.entity.ImgMainEntity" parameterType="com.example.eurekaconsumer.entity.IdEntity">
		SELECT im.id, im.url, im.name, im.local, FORMAT(t.mean,2) distances
		  FROM img_main im,
	   (SELECT id1.img_id_b id,(id1.distances+id2.distances)/2 mean
		  FROM img_dist id1,img_dist id2
		 WHERE id1.img_id_b = id2.img_id_b
		   AND id1.img_id_a = #{imgIdA}
		   AND id2.img_id_a = #{imgIdB}) t
		 WHERE im.id = t.id
	  ORDER BY t.mean
		LIMIT 10
	</select>
</mapper>